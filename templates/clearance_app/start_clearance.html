{% extends 'clearance_app/base.html' %}
{% load static %}
{% block title %}{% if clearance.status == 'rejected' %}Resubmit{% else %}Start{% endif %} Clearance - ACU Clearance System{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/clearance-upload.css' %}">
{% endblock %}

{% block content %}
<div class="clearance-upload-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-content">
            <h1 class="page-title">
                {% if clearance.status == 'rejected' %}
                    <span class="rejected-title">
                        <svg class="title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        Resubmit Clearance
                    </span>
                {% else %}
                    <span class="start-title">
                        <svg class="title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                        Start Clearance Process
                    </span>
                {% endif %}
            </h1>
            <p class="page-subtitle">Upload your required clearance documents</p>
        </div>
        <a href="{% url 'dashboard' %}" class="btn btn-secondary">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            Back to Dashboard
        </a>
    </div>

    <!-- Rejection Notice -->
    {% if clearance.status == 'rejected' %}
    <div class="alert-banner alert-warning">
        <div class="alert-icon-wrapper">
            <svg class="alert-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
        </div>
        <div class="alert-content">
            <strong>Your clearance was rejected</strong>
            <p>Please review the comments from departments, make necessary corrections, and resubmit your clearance.</p>
        </div>
    </div>
    {% endif %}

    <!-- Instructions Card -->
    <div class="content-card instructions-card">
        <div class="card-header">
            <h3 class="card-title">
                <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
                Important Instructions
            </h3>
        </div>
        <div class="card-body">
            <div class="instructions-content">
                <div class="instruction-section">
                    <h4 class="instruction-title">Required Documents:</h4>
                    <ul class="instruction-list">
                        <li>
                            <svg class="list-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="9 11 12 14 22 4"></polyline>
                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                            </svg>
                            <strong>School Fee Receipt</strong> - Proof of payment for current session
                        </li>
                        <li>
                            <svg class="list-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="9 11 12 14 22 4"></polyline>
                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                            </svg>
                            <strong>ID Card</strong> - Valid student identification card (optional)
                        </li>
                        <li>
                            <svg class="list-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="9 11 12 14 22 4"></polyline>
                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                            </svg>
                            <strong>Additional Documents</strong> - Any other required clearance documents
                        </li>
                    </ul>
                </div>

                <div class="instruction-section">
                    <h4 class="instruction-title">Upload Guidelines:</h4>
                    <ul class="instruction-list">
                        <li>
                            <svg class="list-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            Accepted formats: <strong>PDF, JPG, PNG</strong>
                        </li>
                        <li>
                            <svg class="list-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            Maximum file size: <strong>5MB per file</strong>
                        </li>
                        <li>
                            <svg class="list-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            Ensure documents are <strong>clear and readable</strong>
                        </li>
                        <li>
                            <svg class="list-icon warning" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                            You <strong>cannot edit</strong> documents after submission
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Form Card -->
    <div class="content-card upload-card">
        <div class="card-header">
            <h3 class="card-title">
                <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                Upload Document
            </h3>
        </div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data" class="upload-form">
                {% csrf_token %}
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="id_document_type" class="form-label">Document Type *</label>
                        {{ form.document_type }}
                        {% if form.document_type.errors %}
                        <span class="form-error">{{ form.document_type.errors.0 }}</span>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="id_file" class="form-label">Select File *</label>
                        <div class="file-upload-wrapper">
                            {{ form.file }}
                            <div class="file-upload-placeholder">
                                <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                <p class="upload-text">Click to select file</p>
                                <p class="upload-hint">PDF, JPG, PNG (max 5MB)</p>
                            </div>
                        </div>
                        {% if form.file.errors %}
                        <span class="form-error">{{ form.file.errors.0 }}</span>
                        {% endif %}
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-full">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    Upload Document
                </button>
            </form>
        </div>
    </div>

    <!-- Uploaded Documents Card -->
    <div class="content-card documents-card">
        <div class="card-header">
            <h3 class="card-title">
                <svg class="card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                </svg>
                Uploaded Documents
                <span class="document-count {% if documents.count > 0 %}has-documents{% endif %}">
                    {{ documents.count }}
                </span>
            </h3>
        </div>
        <div class="card-body">
            {% if documents %}
                <div class="success-message">
                    <svg class="success-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    <p>You have uploaded <strong>{{ documents.count }}</strong> document{{ documents.count|pluralize }}. Review them below and submit when ready.</p>
                </div>

                <div class="documents-list">
                    {% for doc in documents %}
                        <div class="document-item">
                            <div class="document-icon-large">
                                {% if doc.get_file_extension == 'pdf' %}
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                    </svg>
                                {% else %}
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21 15 16 10 5 21"></polyline>
                                    </svg>
                                {% endif %}
                            </div>
                            
                            <div class="document-details">
                                <h4 class="document-title">{{ doc.get_document_type_display }}</h4>
                                <p class="document-filename">{{ doc.file_name }}</p>
                                <p class="document-metadata">
                                    <span>{{ doc.file_size|filesizeformat }}</span>
                                    <span class="separator">•</span>
                                    <span>{{ doc.uploaded_at|date:"M d, Y H:i" }}</span>
                                </p>
                            </div>
                            
                            <div class="document-actions">
                                <a href="{{ doc.file.url }}" class="action-btn view-btn" target="_blank" title="View Document">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    View
                                </a>
                                <a href="{% url 'delete_document' doc.id %}" 
                                   class="action-btn delete-btn" 
                                   onclick="return confirm('Are you sure you want to delete this document?\n\nDocument: {{ doc.get_document_type_display }}\nFile: {{ doc.file_name }}');"
                                   title="Delete Document">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                    Delete
                                </a>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <!-- Submit Clearance Section -->
                <div class="submit-section">
                    <div class="submit-header">
                        <svg class="submit-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                        <div>
                            <h4 class="submit-title">Ready to Submit?</h4>
                            <p class="submit-description">Make sure all your documents are uploaded and correct. Once submitted, you cannot edit or delete documents.</p>
                        </div>
                    </div>
                    
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="submit_clearance" value="1">
                        <button type="submit" class="btn btn-success btn-full btn-large" onclick="return confirm('CONFIRM CLEARANCE SUBMISSION\n\nYou are about to submit your clearance request with {{ documents.count }} document(s).\n\nIMPORTANT:\n• You CANNOT edit or delete documents after submission\n• Your clearance will be routed to departments for approval\n• You can track progress on your dashboard\n\nAre you sure you want to proceed?');">
                            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                            Submit Clearance Request
                        </button>
                    </form>
                </div>
            {% else %}
                <!-- Empty State -->
                <div class="empty-state">
                    <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <h3>No documents uploaded yet</h3>
                    <p>Upload at least one document using the form above to proceed</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}